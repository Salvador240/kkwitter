{"ast":null,"code":"import { push } from \"connected-react-router\";\nexport var ADD_LIKE = \"ADD_LIKE\";\nexport var ADD_LIKE_SUCCESS = \"ADD_LIKE_SUCCESS\";\nexport var CREATE_MESSAGE = \"CREATE_MESSAGE\";\nexport var CREATE_MESSAGE_SUCCESS = \"CREATE_MESSAGE_SUCCESS\";\nexport var DELETE_USER = \"DELETE_USER\";\nexport var DELETE_USER_SUCCESS = \"DELETE_USER_SUCCESS\";\nexport var DELETE_USER_FAILURE = \"DELETE_USER_FAILURE\";\nexport var GET_ANY_USER = \"GET_ANY_USER\";\nexport var GET_ANY_USER_SUCCESS = \"GET_ANY_USER_SUCCESS\";\nexport var GET_ANY_USER_FAILURE = \"GET_ANY_USER_FAILURE\";\nexport var GET_MESSAGE_BY_ID = \"GET_MESSAGE_BY_ID\";\nexport var GET_MESSAGE_BY_ID_SUCCESS = \"GET_MESSAGE_BY_ID_SUCCESS\";\nexport var GET_MESSAGES = \"GET_MESSAGES\";\nexport var GET_MESSAGES_SUCCESS = \"GET_MESSAGES_SUCCESS\";\nexport var GET_MESSAGES_FAILURE = \"GET_MESSAGES_FAILURE\";\nexport var GET_USER = \"GET_USER\";\nexport var GET_USER_SUCCESS = \"GET_USER_SUCCESS\";\nexport var GET_USER_FAILURE = \"GET_USER_FAILURE\";\nexport var LIKE_MESSAGE = \"LIKE_MESSAGE\";\nexport var LOGOUT = \"LOGOUT\";\nexport var LOGOUT_SUCCESS = \"LOGOUT_SUCCESS\";\nexport var LOGOUT_FAILURE = \"LOGOUT_FAILURE\";\nexport var LOGIN = \"LOGIN\";\nexport var LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\nexport var LOGIN_FAILURE = \"LOGIN_FAILURE\";\nexport var REGISTER = \"REGISTER\";\nexport var REGISTER_SUCCESS = \"REGISTER_SUCCESS\";\nexport var REGISTER_FAILURE = \"REGISTER_FAILURE\";\nexport var REMOVE_LIKE = \"REMOVE_LIKE\";\nexport var REMOVE_LIKE_SUCCESS = \"REMOVE_LIKE_SUCCESS\";\nexport var UPDATE_MESSAGE_BY_ID_SUCCESS = \"UPDATE_MESSAGE_BY_ID_SUCCESS\";\nexport var UPDATE_MESSAGE_BY_ID_FAIL = \"UPDATE_MESSAGE_BY_ID_FAIL\";\nexport var UPDATE_USER = \"UPDATE_USER\";\nexport var UPDATE_USER_SUCCESS = \"UPDATE_USER_SUCCESS\";\nexport var UPDATE_USER_FAILURE = \"UPDATE_USER_FAILURE\";\nexport var UPLOAD_USER_IMAGE = \"UPLOAD_USER_IMAGE\";\nexport var UPLOAD_USER_IMAGE_SUCCESS = \"UPLOAD_USER_IMAGE_SUCCESS\";\nexport var UPLOAD_USER_IMAGE_FAIL = \"UPLOAD_USER_IMAGE_FAIL\";\nexport var DOWNLOAD_USER_IMAGE = \"DOWNLOAD_USER_IMAGE\";\nexport var DOWNLOAD_USER_IMAGE_SUCCESS = \"DOWNLOAD_USER_IMAGE_SUCCESS\";\nexport var DOWNLOAD_USER_IMAGE_FAIL = \"DOWNLOAD_USER_IMAGE_FAIL\";\nvar kwitterURL = \"https://kwitter-api.herokuapp.com\";\nexport var login = function login(loginData) {\n  return function (dispatch) {\n    dispatch({\n      type: LOGIN\n    });\n    fetch(\"\".concat(kwitterURL, \"/auth/login\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(loginData)\n    }).then(function (response) {\n      if (!response.ok) {\n        response.json().then(function (err) {\n          throw err;\n        });\n      }\n\n      return response.json();\n    }).then(function (data) {\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: {\n          token: data.token,\n          id: data.id\n        },\n        login: data,\n        result: \"Successful login!\"\n      });\n      dispatch(push(\"/profile\"));\n      dispatch(getUserInfo(data.id));\n    }).catch(function (err) {\n      dispatch({\n        type: LOGIN_FAILURE,\n        result: \"Failed to login. Please enter a valid username and/or password.\"\n      });\n    });\n  };\n};\nexport var getUserInfo = function getUserInfo(userId) {\n  return function (dispatch) {\n    dispatch({\n      type: GET_USER\n    });\n    fetch(\"\".concat(kwitterURL, \"/users/\").concat(userId)).then(function (response) {\n      if (!response.ok) {\n        response.json().then(function (err) {\n          throw err;\n        });\n      }\n\n      return response.json();\n    }).then(function (data) {\n      dispatch({\n        type: GET_USER_SUCCESS,\n        data: data.user\n      });\n    }).then(dispatch(downloadUserImage())).catch(function (err) {\n      dispatch({\n        type: GET_USER_FAILURE,\n        err: err\n      });\n    });\n  };\n};\nexport var register = function register(registerData, history) {\n  return function (dispatch) {\n    dispatch({\n      type: REGISTER\n    });\n    fetch(\"\".concat(kwitterURL, \"/auth/register\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(registerData)\n    }) // hydrates body; always need for api b/c always returns json; if not, it would  be parsed diff\n    // .then(response => response.json()) // if immediately hydrate, it always assumes its correct, so ave to check\n    .then(function (response) {\n      // response.ok means it's in the 200 range;\n      if (!response.ok) {\n        // throw from here, it goes to catch\n        response.json().then(function (err) {\n          throw err;\n        });\n      }\n\n      return response.json();\n    }).then(function (data) {\n      // data looks like w/e we got for resposne in api/psotman\n      // success already has values in state\n      // no setstate cause not in comp\n      // do dispatch on success\n      dispatch({\n        type: REGISTER_SUCCESS,\n        register: data,\n        result: \"Successfully Registered!\"\n      });\n      dispatch(push(\"/profile\"));\n      dispatch(login({\n        username: registerData.username,\n        password: registerData.password\n      }));\n    }).catch(function (err) {\n      // dispatch here on fail\n      dispatch({\n        type: REGISTER_FAILURE,\n        result: \"Failed to register. Please enter a unique username, and make sure all fields have 3-20 characters.\"\n      });\n    });\n  };\n};\nexport var logout = function logout() {\n  return function (dispatch) {\n    fetch(\"\".concat(kwitterURL, \"/auth/logout\")).then(function (response) {\n      if (!response.ok) {\n        response.json().then(function (err) {\n          throw err;\n        });\n      }\n\n      return response.json();\n    }).then(function (data) {\n      dispatch({\n        type: LOGOUT_SUCCESS\n      });\n      dispatch(push(\"/\"));\n    }).catch(function (err) {\n      dispatch({\n        type: LOGOUT_FAILURE,\n        err: err\n      });\n    });\n  };\n};\nexport var deleteUser = function deleteUser(token) {\n  return function (dispatch) {\n    dispatch({\n      type: DELETE_USER\n    });\n    fetch(\"\".concat(kwitterURL, \"/users\"), {\n      method: \"DELETE\",\n      headers: {\n        Authorization: \"Bearer \".concat(token)\n      }\n    }).then(function (response) {\n      if (!response.ok) {\n        response.json().then(function (err) {\n          throw err;\n        });\n      }\n\n      return response.json();\n    }).then(function (data) {\n      console.log(data);\n      dispatch({\n        type: DELETE_USER_SUCCESS\n      });\n      dispatch(push(\"/register\"));\n    }).catch(function (err) {\n      dispatch({\n        type: DELETE_USER_FAILURE,\n        err: err\n      });\n    });\n  };\n};\nexport var updateUser = function updateUser(userData) {\n  return function (dispatch, getState) {\n    var token = getState().authentication.token;\n\n    if (userData.displayName === \"\") {\n      delete userData.displayName;\n    }\n\n    if (userData.password === \"\") {\n      delete userData.password;\n    }\n\n    dispatch({\n      type: UPDATE_USER\n    });\n    fetch(\"\".concat(kwitterURL, \"/users\"), {\n      method: \"PATCH\",\n      headers: {\n        Authorization: \"Bearer \".concat(token),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(userData)\n    }).then(function (response) {\n      if (!response.ok) {\n        response.json().then(function (err) {\n          throw err;\n        });\n      }\n\n      return response.json();\n    }).then(function (data) {\n      dispatch({\n        type: UPDATE_USER_SUCCESS,\n        data: data.user\n      });\n      dispatch(push(\"/profile\"));\n    }).catch(function (err) {\n      dispatch({\n        type: UPDATE_USER_FAILURE,\n        err: err\n      });\n    });\n  };\n};\nexport var getAnyUser = function getAnyUser(userId) {\n  return function (dispatch) {\n    dispatch({\n      type: GET_ANY_USER\n    });\n    fetch(\"\".concat(kwitterURL, \"/users/\").concat(userId)).then(function (response) {\n      if (!response.ok) {\n        response.json().then(function (err) {\n          throw err;\n        });\n      }\n\n      return response.json();\n    }).then(function (data) {\n      dispatch({\n        type: GET_ANY_USER_SUCCESS,\n        data: data.user\n      });\n    }).catch(function (err) {\n      dispatch({\n        type: GET_ANY_USER_FAILURE,\n        err: err\n      });\n    });\n  };\n};\nexport var getMessageById = function getMessageById(messageId) {\n  return function (dispatch) {\n    dispatch({\n      type: GET_MESSAGE_BY_ID\n    });\n    return fetch(\"\".concat(kwitterURL, \"/messages/\").concat(messageId)).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      dispatch({\n        type: GET_MESSAGE_BY_ID_SUCCESS\n      });\n      return data.message;\n    });\n  };\n};\nexport var updateMessageById = function updateMessageById(messageId) {\n  return function (dispatch, getState) {\n    dispatch(getMessageById(messageId)).then(function (message) {\n      var messages = getState().messages;\n      var messageIndex = messages.findIndex(function (message) {\n        return message.id === messageId;\n      });\n\n      if (messageIndex !== -1) {\n        dispatch({\n          type: UPDATE_MESSAGE_BY_ID_SUCCESS,\n          id: messageId,\n          index: messageIndex,\n          message: message\n        });\n      } else {\n        dispatch({\n          type: UPDATE_MESSAGE_BY_ID_FAIL,\n          id: messageId\n        });\n      }\n    });\n  };\n};\nexport var composeMessage = function composeMessage(text) {\n  return function (dispatch, getState) {\n    var token = getState().authentication.token;\n    dispatch({\n      type: CREATE_MESSAGE\n    });\n    return fetch(\"\".concat(kwitterURL, \"/messages\"), {\n      method: \"POST\",\n      headers: {\n        Authorization: \"Bearer \" + token,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        text: text\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      dispatch({\n        type: CREATE_MESSAGE_SUCCESS\n      });\n      var userId = getState().authentication.id;\n      dispatch(getUserInfo(userId));\n    });\n  };\n};\nexport var removeLike = function removeLike(likeId) {\n  return function (dispatch, getState) {\n    var token = getState().authentication.token;\n    dispatch({\n      type: REMOVE_LIKE\n    });\n    return fetch(\"\".concat(kwitterURL, \"/likes/\").concat(likeId), {\n      method: \"DELETE\",\n      headers: {\n        Authorization: \"Bearer \" + token\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      dispatch({\n        type: REMOVE_LIKE_SUCCESS\n      });\n    });\n  };\n};\nexport var addLike = function addLike(messageId) {\n  return function (dispatch, getState) {\n    var token = getState().authentication.token;\n    dispatch({\n      type: ADD_LIKE\n    });\n    return fetch(\"\".concat(kwitterURL, \"/likes\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      },\n      body: JSON.stringify({\n        messageId: messageId\n      })\n    }).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      dispatch({\n        type: ADD_LIKE_SUCCESS\n      });\n    });\n  };\n};\nexport var toggleLike = function toggleLike(messageId) {\n  return function (dispatch, getState) {\n    var message = getState().messages.find(function (message) {\n      return message.id === messageId;\n    });\n    var userId = getState().loggedInUser.id;\n    var like = message.likes.find(function (like) {\n      return like.userId === userId;\n    });\n\n    if (like) {\n      dispatch(removeLike(like.id)).then(function () {\n        dispatch(updateMessageById(messageId));\n      });\n    } else {\n      dispatch(addLike(messageId)).then(function () {\n        dispatch(updateMessageById(messageId));\n      });\n    }\n  };\n};\nexport var likedMessageSuccess = function likedMessageSuccess(likeObj) {\n  return {\n    type: LIKE_MESSAGE,\n    payload: likeObj\n  };\n};\nexport var likeMessage = function likeMessage(userId, messageId, token) {\n  return function (dispatch) {\n    var header = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \".concat(token)\n      },\n      body: JSON.stringify({\n        userId: userId,\n        messageId: messageId\n      })\n    };\n    return fetch(\"\".concat(kwitterURL, \"/messages\"), header).then(function (response) {\n      return response.json();\n    }).then(function (likeObj) {\n      dispatch(likedMessageSuccess(likeObj));\n      return likeObj.like.id;\n    });\n  };\n};\nexport function getMessages() {\n  return function (dispatch, getState) {\n    dispatch({\n      type: GET_MESSAGES\n    });\n    fetch(\"\".concat(kwitterURL, \"/messages\")).then(function (res) {\n      if (res.statusText === \"OK\") {\n        return res.json();\n      }\n    }).then(function (data) {\n      dispatch({\n        type: GET_MESSAGES_SUCCESS,\n        payload: {\n          messages: data.messages\n        }\n      });\n      data.messages.forEach(function (message) {\n        if (getState().users[message.userId]) {\n          return null;\n        } else {\n          dispatch(getAnyUser(message.userId));\n        }\n      });\n      setTimeout(function () {\n        return dispatch(getMessages());\n      }, 5000);\n    }).catch(function (err) {\n      console.log(err);\n      dispatch({\n        type: GET_MESSAGES_FAILURE\n      });\n    });\n  };\n}\nexport var uploadUserImage = function uploadUserImage(formData) {\n  return function (dispatch, getState) {\n    var token = getState().authentication.token;\n    dispatch({\n      type: UPLOAD_USER_IMAGE\n    });\n    fetch(\"\".concat(kwitterURL, \"/users/picture\"), {\n      method: \"PUT\",\n      headers: {\n        Authorization: \"Bearer \".concat(token)\n      },\n      body: formData\n    }).then(function (res) {\n      if (res.ok) {\n        dispatch({\n          type: UPLOAD_USER_IMAGE_SUCCESS,\n          userImageTimestamp: Date.now()\n        });\n        dispatch(downloadUserImage());\n        return;\n      }\n\n      return dispatch({\n        type: UPLOAD_USER_IMAGE_FAIL\n      });\n    });\n  };\n};\nexport var downloadUserImage = function downloadUserImage() {\n  return function (dispatch, getState) {\n    var loggedInUserId = getState().authentication.id;\n    dispatch({\n      type: DOWNLOAD_USER_IMAGE\n    });\n    return fetch(\"\".concat(kwitterURL, \"/users/\").concat(loggedInUserId, \"/picture\")).then(function (res) {\n      if (res.ok) {\n        return res.blob().then(function (result) {\n          return window.URL.createObjectURL(result);\n        });\n      }\n\n      return \"https://react.semantic-ui.com/images/avatar/large/rachel.png\";\n    }).then(function (result) {\n      dispatch({\n        type: DOWNLOAD_USER_IMAGE_SUCCESS,\n        userImage: result\n      });\n    }).catch(function (err) {\n      console.error(err);\n      dispatch({\n        type: DOWNLOAD_USER_IMAGE_FAIL\n      });\n    });\n  };\n};","map":{"version":3,"sources":["/Users/Sdeg/Desktop/workspace/kkwitter/src/Actions/actions.js"],"names":["push","ADD_LIKE","ADD_LIKE_SUCCESS","CREATE_MESSAGE","CREATE_MESSAGE_SUCCESS","DELETE_USER","DELETE_USER_SUCCESS","DELETE_USER_FAILURE","GET_ANY_USER","GET_ANY_USER_SUCCESS","GET_ANY_USER_FAILURE","GET_MESSAGE_BY_ID","GET_MESSAGE_BY_ID_SUCCESS","GET_MESSAGES","GET_MESSAGES_SUCCESS","GET_MESSAGES_FAILURE","GET_USER","GET_USER_SUCCESS","GET_USER_FAILURE","LIKE_MESSAGE","LOGOUT","LOGOUT_SUCCESS","LOGOUT_FAILURE","LOGIN","LOGIN_SUCCESS","LOGIN_FAILURE","REGISTER","REGISTER_SUCCESS","REGISTER_FAILURE","REMOVE_LIKE","REMOVE_LIKE_SUCCESS","UPDATE_MESSAGE_BY_ID_SUCCESS","UPDATE_MESSAGE_BY_ID_FAIL","UPDATE_USER","UPDATE_USER_SUCCESS","UPDATE_USER_FAILURE","UPLOAD_USER_IMAGE","UPLOAD_USER_IMAGE_SUCCESS","UPLOAD_USER_IMAGE_FAIL","DOWNLOAD_USER_IMAGE","DOWNLOAD_USER_IMAGE_SUCCESS","DOWNLOAD_USER_IMAGE_FAIL","kwitterURL","login","loginData","dispatch","type","fetch","method","headers","body","JSON","stringify","then","response","ok","json","err","data","payload","token","id","result","getUserInfo","catch","userId","user","downloadUserImage","register","registerData","history","username","password","logout","deleteUser","Authorization","console","log","updateUser","userData","getState","authentication","displayName","getAnyUser","getMessageById","messageId","res","message","updateMessageById","messages","messageIndex","findIndex","index","composeMessage","text","removeLike","likeId","addLike","toggleLike","find","loggedInUser","like","likes","likedMessageSuccess","likeObj","likeMessage","header","getMessages","statusText","forEach","users","setTimeout","uploadUserImage","formData","userImageTimestamp","Date","now","loggedInUserId","blob","window","URL","createObjectURL","userImage","error"],"mappings":"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","sourcesContent":["import { push } from \"connected-react-router\";\nexport const ADD_LIKE = \"ADD_LIKE\";\nexport const ADD_LIKE_SUCCESS = \"ADD_LIKE_SUCCESS\";\nexport const CREATE_MESSAGE = \"CREATE_MESSAGE\";\nexport const CREATE_MESSAGE_SUCCESS = \"CREATE_MESSAGE_SUCCESS\";\nexport const DELETE_USER = \"DELETE_USER\";\nexport const DELETE_USER_SUCCESS = \"DELETE_USER_SUCCESS\";\nexport const DELETE_USER_FAILURE = \"DELETE_USER_FAILURE\";\nexport const GET_ANY_USER = \"GET_ANY_USER\";\nexport const GET_ANY_USER_SUCCESS = \"GET_ANY_USER_SUCCESS\";\nexport const GET_ANY_USER_FAILURE = \"GET_ANY_USER_FAILURE\";\nexport const GET_MESSAGE_BY_ID = \"GET_MESSAGE_BY_ID\";\nexport const GET_MESSAGE_BY_ID_SUCCESS = \"GET_MESSAGE_BY_ID_SUCCESS\";\nexport const GET_MESSAGES = \"GET_MESSAGES\";\nexport const GET_MESSAGES_SUCCESS = \"GET_MESSAGES_SUCCESS\";\nexport const GET_MESSAGES_FAILURE = \"GET_MESSAGES_FAILURE\";\nexport const GET_USER = \"GET_USER\";\nexport const GET_USER_SUCCESS = \"GET_USER_SUCCESS\";\nexport const GET_USER_FAILURE = \"GET_USER_FAILURE\";\nexport const LIKE_MESSAGE = \"LIKE_MESSAGE\";\nexport const LOGOUT = \"LOGOUT\";\nexport const LOGOUT_SUCCESS = \"LOGOUT_SUCCESS\";\nexport const LOGOUT_FAILURE = \"LOGOUT_FAILURE\";\nexport const LOGIN = \"LOGIN\";\nexport const LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\nexport const LOGIN_FAILURE = \"LOGIN_FAILURE\";\nexport const REGISTER = \"REGISTER\";\nexport const REGISTER_SUCCESS = \"REGISTER_SUCCESS\";\nexport const REGISTER_FAILURE = \"REGISTER_FAILURE\";\nexport const REMOVE_LIKE = \"REMOVE_LIKE\";\nexport const REMOVE_LIKE_SUCCESS = \"REMOVE_LIKE_SUCCESS\";\nexport const UPDATE_MESSAGE_BY_ID_SUCCESS = \"UPDATE_MESSAGE_BY_ID_SUCCESS\";\nexport const UPDATE_MESSAGE_BY_ID_FAIL = \"UPDATE_MESSAGE_BY_ID_FAIL\";\nexport const UPDATE_USER = \"UPDATE_USER\";\nexport const UPDATE_USER_SUCCESS = \"UPDATE_USER_SUCCESS\";\nexport const UPDATE_USER_FAILURE = \"UPDATE_USER_FAILURE\";\n\n\nexport const UPLOAD_USER_IMAGE = \"UPLOAD_USER_IMAGE\";\nexport const UPLOAD_USER_IMAGE_SUCCESS = \"UPLOAD_USER_IMAGE_SUCCESS\";\nexport const UPLOAD_USER_IMAGE_FAIL = \"UPLOAD_USER_IMAGE_FAIL\";\n\nexport const DOWNLOAD_USER_IMAGE = \"DOWNLOAD_USER_IMAGE\";\nexport const DOWNLOAD_USER_IMAGE_SUCCESS = \"DOWNLOAD_USER_IMAGE_SUCCESS\";\nexport const DOWNLOAD_USER_IMAGE_FAIL = \"DOWNLOAD_USER_IMAGE_FAIL\";\n\n\n\n\nconst kwitterURL = \"https://kwitter-api.herokuapp.com\";\n\nexport const login = loginData => dispatch => {\n  dispatch({ type: LOGIN });\n  fetch(`${kwitterURL}/auth/login`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(loginData)\n  })\n    .then(response => {\n      if (!response.ok) {\n        response.json().then(err => {\n          throw err;\n        });\n      }\n      return response.json();\n    })\n    .then(data => {\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: {\n          token: data.token,\n          id: data.id\n        },\n        login: data,\n        result: \"Successful login!\"\n      });\n      dispatch(push(\"/profile\"));\n      dispatch(getUserInfo(data.id));\n    })\n    .catch(err => {\n      dispatch({\n        type: LOGIN_FAILURE,\n        result:\n          \"Failed to login. Please enter a valid username and/or password.\"\n      });\n    });\n};\n\nexport const getUserInfo = userId => dispatch => {\n  dispatch({ type: GET_USER });\n  fetch(`${kwitterURL}/users/${userId}`)\n    .then(response => {\n      if (!response.ok) {\n        response.json().then(err => {\n          throw err;\n        });\n      }\n      return response.json();\n    })\n    .then(data => {\n      dispatch({ type: GET_USER_SUCCESS, data: data.user });\n    })\n    .then(dispatch(downloadUserImage()))\n    .catch(err => {\n      dispatch({ type: GET_USER_FAILURE, err });\n    });\n};\n\nexport const register = (registerData, history) => dispatch => {\n  dispatch({\n    type: REGISTER\n  });\n  \n  fetch(`${kwitterURL}/auth/register`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(\n     \n      registerData\n    )\n  })\n    // hydrates body; always need for api b/c always returns json; if not, it would  be parsed diff\n    // .then(response => response.json()) // if immediately hydrate, it always assumes its correct, so ave to check\n    .then(response => {\n      // response.ok means it's in the 200 range;\n      if (!response.ok) {\n        // throw from here, it goes to catch\n        response.json().then(err => {\n          throw err;\n        });\n      }\n      return response.json(); \n    })\n    .then(data => {\n      // data looks like w/e we got for resposne in api/psotman\n      // success already has values in state\n      // no setstate cause not in comp\n      // do dispatch on success\n      dispatch({\n        type: REGISTER_SUCCESS,\n        register: data,\n        result: \"Successfully Registered!\" \n      });\n      dispatch(push(\"/profile\"));\n      dispatch(\n        login({\n          username: registerData.username,\n          password: registerData.password\n        })\n      ); \n    })\n    .catch(err => {\n      // dispatch here on fail\n      dispatch({\n        type: REGISTER_FAILURE,\n        result: `Failed to register. Please enter a unique username, and make sure all fields have 3-20 characters.`\n      });\n    });\n};\n\nexport const logout = () => dispatch => {\n  fetch(`${kwitterURL}/auth/logout`)\n    .then(response => {\n      if (!response.ok) {\n        response.json().then(err => {\n          throw err;\n        });\n      }\n      return response.json();\n    })\n    .then(data => {\n      dispatch({ type: LOGOUT_SUCCESS });\n      dispatch(push(\"/\"));\n    })\n    .catch(err => {\n      dispatch({ type: LOGOUT_FAILURE, err });\n    });\n};\n\nexport const deleteUser = token => dispatch => {\n  dispatch({ type: DELETE_USER });\n  fetch(`${kwitterURL}/users`, {\n    method: \"DELETE\",\n    headers: {\n      Authorization: `Bearer ${token}`\n    }\n  })\n    .then(response => {\n      if (!response.ok) {\n        response.json().then(err => {\n          throw err;\n        });\n      }\n      return response.json();\n    })\n    .then(data => {\n      console.log(data);\n      dispatch({ type: DELETE_USER_SUCCESS });\n      dispatch(push(\"/register\"));\n    })\n    .catch(err => {\n      dispatch({ type: DELETE_USER_FAILURE, err });\n    });\n};\n\nexport const updateUser = userData => (dispatch, getState) => {\n  const token = getState().authentication.token;\n  if (userData.displayName === \"\") {\n    delete userData.displayName;\n  }\n  if (userData.password === \"\") {\n    delete userData.password;\n  }\n  dispatch({ type: UPDATE_USER });\n  fetch(`${kwitterURL}/users`, {\n    method: \"PATCH\",\n    headers: {\n      Authorization: `Bearer ${token}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(userData)\n  })\n    .then(response => {\n      if (!response.ok) {\n        response.json().then(err => {\n          throw err;\n        });\n      }\n      return response.json();\n    })\n    .then(data => {\n      dispatch({ type: UPDATE_USER_SUCCESS, data: data.user });\n      dispatch(push(\"/profile\"));\n    })\n    .catch(err => {\n      dispatch({ type: UPDATE_USER_FAILURE, err });\n    });\n};\n\nexport const getAnyUser = userId => dispatch => {\n  dispatch({ type: GET_ANY_USER });\n  fetch(`${kwitterURL}/users/${userId}`)\n    .then(response => {\n      if (!response.ok) {\n        response.json().then(err => {\n          throw err;\n        });\n      }\n      return response.json();\n    })\n    .then(data => {\n      dispatch({ type: GET_ANY_USER_SUCCESS, data: data.user });\n    })\n    .catch(err => {\n      dispatch({ type: GET_ANY_USER_FAILURE, err });\n    });\n};\n\nexport const getMessageById = messageId => dispatch => {\n  dispatch({ type: GET_MESSAGE_BY_ID });\n  return fetch(`${kwitterURL}/messages/${messageId}`)\n    .then(res => res.json())\n    .then(data => {\n      dispatch({ type: GET_MESSAGE_BY_ID_SUCCESS });\n      return data.message;\n    });\n};\n\nexport const updateMessageById = messageId => (dispatch, getState) => {\n  dispatch(getMessageById(messageId)).then(message => {\n    const messages = getState().messages;\n    const messageIndex = messages.findIndex(\n      message => message.id === messageId\n    );\n    if (messageIndex !== -1) {\n      dispatch({\n        type: UPDATE_MESSAGE_BY_ID_SUCCESS,\n        id: messageId,\n        index: messageIndex,\n        message\n      });\n    } else {\n      dispatch({ type: UPDATE_MESSAGE_BY_ID_FAIL, id: messageId });\n    }\n  });\n};\n\nexport const composeMessage = text => (dispatch, getState) => {\n  const token = getState().authentication.token;\n  dispatch({ type: CREATE_MESSAGE });\n  return fetch(`${kwitterURL}/messages`, {\n    method: \"POST\",\n    headers: {\n      Authorization: \"Bearer \" + token,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({ text })\n  })\n    .then(res => res.json())\n    .then(data => {\n      dispatch({\n        type: CREATE_MESSAGE_SUCCESS\n      });\n      const userId = getState().authentication.id;\n      dispatch(getUserInfo(userId));\n    });\n};\n\nexport const removeLike = likeId => (dispatch, getState) => {\n  const token = getState().authentication.token;\n  dispatch({ type: REMOVE_LIKE });\n  return fetch(`${kwitterURL}/likes/${likeId}`, {\n    method: \"DELETE\",\n    headers: {\n      Authorization: \"Bearer \" + token\n    }\n  })\n    .then(res => res.json())\n    .then(data => {\n      dispatch({\n        type: REMOVE_LIKE_SUCCESS\n      });\n    });\n};\nexport const addLike = messageId => (dispatch, getState) => {\n  const token = getState().authentication.token;\n  dispatch({ type: ADD_LIKE });\n  return fetch(`${kwitterURL}/likes`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: \"Bearer \" + token\n    },\n    body: JSON.stringify({ messageId })\n  })\n    .then(res => res.json())\n    .then(data => {\n      dispatch({ type: ADD_LIKE_SUCCESS });\n    });\n};\nexport const toggleLike = messageId => (dispatch, getState) => {\n  const message = getState().messages.find(message => message.id === messageId);\n  const userId = getState().loggedInUser.id;\n\n  const like = message.likes.find(like => like.userId === userId);\n\n  if (like) {\n    dispatch(removeLike(like.id)).then(() => {\n      dispatch(updateMessageById(messageId));\n    });\n  } else {\n    dispatch(addLike(messageId)).then(() => {\n      dispatch(updateMessageById(messageId));\n    });\n  }\n};\nexport const likedMessageSuccess = likeObj => {\n  return {\n    type: LIKE_MESSAGE,\n    payload: likeObj\n  };\n};\nexport const likeMessage = (userId, messageId, token) => dispatch => {\n  const header = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${token}`\n    },\n    body: JSON.stringify({\n      userId: userId,\n      messageId: messageId\n    })\n  };\n  return fetch(`${kwitterURL}/messages`, header)\n    .then(response => response.json())\n    .then(likeObj => {\n      dispatch(likedMessageSuccess(likeObj));\n      return likeObj.like.id;\n    });\n};\n\nexport function getMessages() {\n  return function(dispatch, getState) {\n    dispatch({ type: GET_MESSAGES });\n    fetch(`${kwitterURL}/messages`)\n      .then(res => {\n        if (res.statusText === \"OK\") {\n          return res.json(); \n        }\n      })\n      .then(data => {\n        dispatch({\n          type: GET_MESSAGES_SUCCESS,\n          payload: {\n            messages: data.messages\n          }\n        });\n        data.messages.forEach(message => {\n          if (getState().users[message.userId]) {\n            return null;\n          } else {\n            dispatch(getAnyUser(message.userId));\n          }\n        });\n        setTimeout(() => dispatch(getMessages()), 5000); \n      })\n      .catch(err => {\n        console.log(err);\n        dispatch({ type: GET_MESSAGES_FAILURE });\n      });\n  };\n}\n\n\nexport const uploadUserImage = formData => (dispatch, getState) => {\n  const token = getState().authentication.token;\n  dispatch({\n    type: UPLOAD_USER_IMAGE\n  });\n\n  fetch(`${kwitterURL}/users/picture`, {\n    method: \"PUT\",\n    headers: {\n      Authorization: `Bearer ${token}`\n    },\n    body: formData\n  }).then(res => {\n    if (res.ok) {\n      dispatch({\n        type: UPLOAD_USER_IMAGE_SUCCESS,\n        userImageTimestamp: Date.now()\n      });\n      dispatch(downloadUserImage());\n      return;\n    }\n\n    return dispatch({\n      type: UPLOAD_USER_IMAGE_FAIL\n    });\n  });\n};\n\nexport const downloadUserImage = () => (dispatch, getState) => {\n  const loggedInUserId = getState().authentication.id\n  dispatch({ type: DOWNLOAD_USER_IMAGE })\n  return fetch(`${kwitterURL}/users/${loggedInUserId}/picture`)\n    .then(res => {\n      if (res.ok) {\n        return res.blob().then(result => window.URL.createObjectURL(result));\n      }\n      return \"https://react.semantic-ui.com/images/avatar/large/rachel.png\";\n    })\n    .then(result => {\n      dispatch({\n        type: DOWNLOAD_USER_IMAGE_SUCCESS,\n        userImage: result\n      });\n    })\n    .catch(err => {\n      console.error(err);\n      dispatch({\n        type: DOWNLOAD_USER_IMAGE_FAIL\n      });\n    });\n};\n"]},"metadata":{},"sourceType":"module"}